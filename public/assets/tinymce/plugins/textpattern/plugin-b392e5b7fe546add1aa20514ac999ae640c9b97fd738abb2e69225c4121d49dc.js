!function(t){"use strict";var n,e,r,a,o,i=function(t){var n=t,e=function(){return n};return{get:e,set:function(t){n=t},clone:function(){return i(e())}}},f=tinymce.util.Tools.resolve("tinymce.PluginManager"),u=function(){},s=function(t){return function(){return t}},c=s(!1),l=s(!0),d=function(){return g},g=(n=function(t){return t.isNone()},a={fold:function(t){return t()},is:c,isSome:c,isNone:l,getOr:r=function(t){return t},getOrThunk:e=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:s(null),getOrUndefined:s(undefined),or:r,orThunk:e,map:d,each:u,bind:d,exists:c,forall:l,filter:d,equals:n,equals_:n,toArray:function(){return[]},toString:s("none()")},Object.freeze&&Object.freeze(a),a),m=function(t){var n=s(t),e=function(){return a},r=function(n){return n(t)},a={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:l,isNone:c,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return m(n(t))},each:function(n){n(t)},bind:r,exists:r,forall:r,filter:function(n){return n(t)?a:g},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(c,function(n){return e(t,n)})}};return a},h={some:m,none:d,from:function(t){return null===t||t===undefined?g:m(t)}},p=(o="function",function(t){return function(t){if(null===t)return"null";var n=typeof t;return"object"===n&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===n&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":n}(t)===o}),v=Array.prototype.slice,y=function(t,n){for(var e=[],r=0,a=t.length;r<a;r++){var o=t[r];n(o,r)&&e.push(o)}return e},O=(p(Array.from)&&Array.from,Object.hasOwnProperty),P=function(t,n){return O.call(t,n)},x=function(t){return P(t,"start")&&P(t,"end")},T=function(t){return!P(t,"end")&&!P(t,"replacement")},b=function(t){return P(t,"replacement")},k=function(t){return n=t,e=function(t,n){return t.start.length===n.start.length?0:t.start.length>n.start.length?-1:1},(r=v.call(n,0)).sort(e),r;var n,e,r},C=function(t){return{inlinePatterns:k(y(t,x)),blockPatterns:k(y(t,T)),replacementPatterns:y(t,b)}},D=function(t){return{setPatterns:function(n){t.set(C(n))},getPatterns:function(){return function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),a=0;for(n=0;n<e;n++)for(var o=arguments[n],i=0,f=o.length;i<f;i++,a++)r[a]=o[i];return r}(t.get().inlinePatterns,t.get().blockPatterns,t.get().replacementPatterns)}}},S=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"***",end:"***",format:["bold","italic"]},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],A=function(t){var n,e,r=(n=t,e="textpattern_patterns",P(n,e)?h.from(n[e]):h.none()).getOr(S);return C(r)},N=tinymce.util.Tools.resolve("tinymce.util.Delay"),R=tinymce.util.Tools.resolve("tinymce.util.VK"),w=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),I=tinymce.util.Tools.resolve("tinymce.util.Tools"),j=function(t,n){for(var e=0;e<t.length;e++){var r=t[e];if(0===n.indexOf(r.start)&&(!r.end||n.lastIndexOf(r.end)===n.length-r.end.length))return r}},E=function(n,e,r){if(!1!==e.collapsed){var a=e.startContainer,o=a.data,i=!0===r?1:0;if(3===a.nodeType){var f=function(t,n,e,r){var a,o,i,f,u,s;for(o=0;o<t.length;o++)if((a=t[o]).end!==undefined&&(f=a,u=e,s=r,n.substr(u-f.end.length-s,f.end.length)===f.end)&&0<e-r-(i=a).end.length-i.start.length)return a}(n,o,e.startOffset,i);if(f!==undefined){var u=o.lastIndexOf(f.end,e.startOffset-i),s=o.lastIndexOf(f.start,u-f.end.length);if(u=o.indexOf(f.end,s+f.start.length),-1!==s){var c=t.document.createRange();c.setStart(a,s),c.setEnd(a,u+f.end.length);var l=j(n,c.toString());if(!(f===undefined||l!==f||a.data.length<=f.start.length+f.end.length))return{pattern:f,startOffset:s,endOffset:u}}}}}},q=function(t){return t&&3===t.nodeType},L=function(t,n,e){var r=t.dom.createRng();r.setStart(n,e),r.setEnd(n,e),t.selection.setRng(r)},M=function(t,n,e){var r=t.selection.getRng();return h.from(E(n,r,e)).map(function(n){return function(t,n,e,r){var a=I.isArray(e.pattern.format)?e.pattern.format:[e.pattern.format];if(0!==I.grep(a,function(n){var e=t.formatter.get(n);return e&&e[0].inline}).length)return t.undoManager.transact(function(){var o,i,f,u;o=n,i=e.pattern,f=e.endOffset,(o=0<(u=e.startOffset)?o.splitText(u):o).splitText(f-u+i.end.length),o.deleteData(0,i.start.length),o.deleteData(o.data.length-i.end.length,i.end.length),n=o,r&&t.selection.setCursorLocation(n.nextSibling,1),a.forEach(function(e){t.formatter.apply(e,{},n)})}),n}(t,r.startContainer,n,e)})},U=function(t,n,e){var r=t.selection.getRng(),a=r.startContainer;r.collapsed&&q(a)&&function(t,n,e){for(var r=0;r<t.length;r++){var a=e.lastIndexOf(t[r].start,n);if(-1!==a)return h.some({pattern:t[r],startOffset:a})}return h.none()}(n,r.startOffset,a.data).each(function(n){var r,o,i,f,u,s,c,l=e?h.some((r=a,i=(o=n).startOffset+o.pattern.start.length,f=r.data.slice(i,i+1),r.deleteData(i,1),f)):h.none();u=t,c=n,(s=a).deleteData(c.startOffset,c.pattern.start.length),u.insertContent(c.pattern.replacement),h.from(s.nextSibling).filter(q).each(function(t){t.insertData(0,s.data),u.dom.remove(s)}),l.each(function(n){return function(t,n){var e=t.selection.getRng(),r=e.startContainer;if(q(r)){var a=e.startOffset;r.insertData(a,n),L(t,r,a+n.length)}else{var o=t.dom.doc.createTextNode(n);e.insertNode(o),L(t,o,o.length)}}(t,n)})})},_=function(t,n,e){for(var r=0;r<t.length;r++)if(e(t[r],n))return!0},z=function(t,n){var e,r,a,o;e=t,r=n.replacementPatterns,U(e,r,!1),a=t,o=n.inlinePatterns,M(a,o,!1).each(function(t){L(a,t,t.data.length)}),function(t,n){var e,r,a,o,i,f,u,s,c,l,d;if(e=t.selection,r=t.dom,e.isCollapsed()&&(u=r.getParent(e.getStart(),"p"))){for(c=new w(u,u);i=c.next();)if(q(i)){o=i;break}if(o){if(!(s=j(n,o.data)))return;if(a=(l=e.getRng(!0)).startContainer,d=l.startOffset,o===a&&(d=Math.max(0,d-s.start.length)),I.trim(o.data).length===s.start.length)return;s.format&&(f=t.formatter.get(s.format))&&f[0].block&&(o.deleteData(0,s.start.length),t.formatter.apply(s.format,{},o),l.setStart(a,d),l.collapse(!0),e.setRng(l)),s.cmd&&t.undoManager.transact(function(){o.deleteData(0,s.start.length),t.execCommand(s.cmd)})}}}(t,n.blockPatterns)},K=function(t,n){var e,r,a,o;e=t,r=n.replacementPatterns,U(e,r,!0),a=t,o=n.inlinePatterns,M(a,o,!0).each(function(t){var n=t.data.slice(-1);if(/[\u00a0 ]/.test(n)){t.deleteData(t.data.length-1,1);var e=a.dom.doc.createTextNode(n);a.dom.insertAfter(e,t.parentNode),L(a,e,1)}})},V=function(t,n){return _(t,n,function(t,n){return t.charCodeAt(0)===n.charCode})},W=function(t,n){return _(t,n,function(t,n){return t===n.keyCode&&!1===R.modifierPressed(n)})},B=function(t,n){var e=[",",".",";",":","!","?"],r=[32];t.on("keydown",function(e){13!==e.keyCode||R.modifierPressed(e)||z(t,n.get())},!0),t.on("keyup",function(e){W(r,e)&&K(t,n.get())}),t.on("keypress",function(r){V(e,r)&&N.setEditorTimeout(t,function(){K(t,n.get())})})};f.add("textpattern",function(t){var n=i(A(t.settings));return B(t,n),D(n)})}(window);