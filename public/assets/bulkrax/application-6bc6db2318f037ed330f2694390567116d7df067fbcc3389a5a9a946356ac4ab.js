function hideUnhide(e){(hide($("body").find(".export-source-option")),e.length>0)&&unhideSelected($("."+e));"collection"===e&&initCollectionSearchInputs()}function hide(e){e.addClass("hidden"),e.find("#exporter_export_source").addClass("hidden").attr("type","hidden")}function unhideSelected(e){e.removeClass("hidden").removeAttr("type"),e.parent().removeClass("hidden").removeAttr("type")}function initCollectionSearchInputs(){$("[data-autocomplete]").each(function(){var e=$(this);initSelect2(e,e.data("autocompleteUrl"))})}function initSelect2(e,t){e.select2({minimumInputLength:2,initSelection:(e,t)=>{t({id:e.val(),text:e.val()})},ajax:{url:t,dataType:"json",data:e=>({q:e}),results:function(e){return{results:e.map(e=>({id:e.id,text:e.label[0]}))}}}}).select2("data",null)}function prepBulkrax(){var e=$(".refresh-set-source"),t=$("#importer_parser_fields_base_url"),r=t.val();if(handleFileToggle($("#importer_parser_fields_import_file_path").val()),$("body").on("click",".refresh-set-source",function(r){r.preventDefault(),external_set_select=$("#importer_parser_fields_set"),handleSourceLoad(e,t,external_set_select)}),$("body").on("blur","#importer_parser_fields_base_url",function(l){l.preventDefault(),t=$("#importer_parser_fields_base_url"),r!=t.val()&&(external_set_select=$("#importer_parser_fields_set"),handleSourceLoad(e,t,external_set_select),r=t.val())}),$("body").on("change","#importer_parser_klass",function(){handleParserKlass()}),handleParserKlass(),null==(l=document.getElementById("new_importer")))var l=document.getElementsByClassName("edit_importer")[0];if(null!=l){var i={childList:!0,attributes:!0};new MutationObserver(function(e){for(var t of e)if("childList"==t.type){browseButton=document.getElementById("browse");var r=/selected_files\[[0-9*]\]\[url\]/;for(var l of t.addedNodes)if(l.attributes!=undefined){var i=l.attributes.name.value;r.test(i)&&(browseButton.innerHTML="Cloud Files Added",browseButton.style.backgroundColor="green",browseButton.after(document.createElement("br"),l.value.toString()))}}}).observe(l,i)}}function handleFileToggle(e){e===undefined||0===e.length?($("#file_path").hide(),$("#file_upload").hide(),$("#cloud").hide(),$("#file_path input").attr("required",null),$("#file_upload input").attr("required",null)):($("#file_path").show(),$("#file_upload").hide(),$("#cloud").hide(),$("#file_path input").attr("required","required"),$("#file_upload input").attr("required",null),$("#importer_parser_fields_file_style_specify_a_path_on_the_server").attr("checked",!0)),$("#importer_parser_fields_file_style_upload_a_file").click(function(){$("#file_path").hide(),$("#file_upload").show(),$("#cloud").hide(),$("#file_path input").attr("required",null),$("#file_upload input").attr("required","required")}),$("#importer_parser_fields_file_style_specify_a_path_on_the_server").click(function(){$("#file_path").show(),$("#file_upload").hide(),$("#cloud").hide(),$("#file_path input").attr("required","required"),$("#file_upload input").attr("required",null)}),$("#importer_parser_fields_file_style_add_cloud_file").click(function(){$("#file_path").hide(),$("#file_upload").hide(),$("#cloud").show(),$("#file_path input").attr("required",null),$("#file_upload input").attr("required",null)})}function handleParserKlass(){$(".oai_fields").length>0&&(window.oai_fields=$(".oai_fields").detach()),$(".csv_fields").length>0&&(window.csv_fields=$(".csv_fields").detach()),$(".bagit_fields").length>0&&(window.bagit_fields=$(".bagit_fields").detach()),$(".xml_fields").length>0&&(window.xml_fields=$(".xml_fields").detach());var e=$("#importer_parser_klass option:selected");e.length>0&&e.data("partial")&&e.data("partial").length>0&&$(".parser_fields").append(window[e.data("partial")]),handleFileToggle($("#importer_parser_fields_import_file_path").val())}function handleSourceLoad(e,t,r){if(""!=t.val()){var l=e.html();e.html("Refreshing..."),e.attr("disabled",!0),$.post("/importers/external_sets",{base_url:t.val()},function(t){t.error?setError(r,t.error):genExternalSetOptions(r,t.sets),e.html(l),e.attr("disabled",!1)})}}function genExternalSetOptions(e,t){out='<option value="">- Select One -</option>',out+=t.map(function(e){return'<option value="'+e[1]+'">'+e[0]+"</option>"}),e.html(out),e.attr("disabled",!1)}function setError(e){e.html('<option value="none">Error - Please enter Base URL and try again</option>'),e.attr("disabled",!0)}$(document).on("turbolinks:load ready",function(){$("button#err_toggle").click(function(){$("#error_trace").toggle()}),$("button#fm_toggle").click(function(){$("#field_mapping").toggle()})}),$(document).on("turbolinks:load ready",function(){$("button#entry_error").click(function(){$("#error_trace").toggle()}),$("button#raw_button").click(function(){$("#raw_metadata").toggle()}),$("button#parsed_button").click(function(){$("#parsed_metadata").toggle()})}),$(document).on({ready:prepBulkrax,"turbolinks:load":prepBulkrax});